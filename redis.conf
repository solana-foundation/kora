# Redis configuration for Kora usage limiting
# This config enables RDB persistence for crash recovery

# RDB Persistence Configuration
# Save the DB to disk if at least the given number of changes were performed within the given time
# After 900 sec (15 min) if at least 1 key changed
save 900 1
# After 300 sec (5 min) if at least 10 keys changed
save 300 10
# After 60 sec if at least 10000 keys changed
save 60 10000

# Compress string objects in RDB dumps
rdbcompression yes

# Checksum the RDB file
rdbchecksum yes

# The filename for the RDB file
dbfilename dump.rdb

# The working directory where RDB will be written
dir /data

# Stop accepting writes if RDB snapshot fails
stop-writes-on-bgsave-error yes

# Network binding
bind 0.0.0.0
protected-mode no
port 6379

# Memory Management
# Set max memory to prevent unbounded growth
maxmemory 256mb

# When max memory is reached, evict keys with TTL first (good for rate limiting)
maxmemory-policy volatile-ttl

# Logging
loglevel notice

# Performance tuning for rate limiting use case
# These settings optimize for our specific use case of counters with TTL
timeout 0
tcp-keepalive 300
tcp-backlog 511

# Disable AOF since RDB is sufficient for rate limiting
# (losing a few seconds of data on crash is acceptable for rate limits)
appendonly no

# Security (uncomment and set if needed)
# requirepass your_redis_password_here